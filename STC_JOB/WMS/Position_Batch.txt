TRUNCATE TABLE STCBI106.STC_FACT_WMS_POSITION_BATCH;
COMMIT;
INSERT INTO STCBI106.STC_FACT_WMS_POSITION_BATCH
( 
  ARTICLE_ID
, CATEGORY_ID
, CAT_MANG_ID
, COMPANY_ID
, BRAND_ID
, FOOD_CAT_ID
, GRADE1_ID
, GRADE2_ID
, WH_ID
, SIZE_ID
, LOCATION_ID
, PACKING_ID
, ITEM_UOM_ID
, ITEM_ID
, CARTON_ID
, PSB_SYS_ID
, PSB_PI_SYS_ID
, PSB_PALLET_NO
, PSB_PALLET_SYS_ID
, PSB_RCVD_DT
, PSB_BATCH_NO
, PSB_MANF_DT
, PSB_EXP_DT
, PSB_RCVD_QTY_BU
, PSB_ISSD_QTY_BU
, PSB_STK_QTY_BU
, PSB_HOLD_QTY_BU
, PSB_RCVD_QTY_BU_1
, PSB_RCVD_QTY_BU_2
, PSB_RCVD_QTY_BU_3
, PSB_RCVD_QTY_BU_4
, PSB_RCVD_QTY_BU_5
, PSB_ISSD_QTY_BU_1
, PSB_ISSD_QTY_BU_2
, PSB_ISSD_QTY_BU_3
, PSB_ISSD_QTY_BU_4
, PSB_ISSD_QTY_BU_5
, PSB_RESV_QTY_BU
, PSB_REJECT_QTY_BU
, PSB_CR_DT
, PSB_CR_UID
, PSB_UPD_DT
, PSB_UPD_UID
, PSB_PUW_HOLD_QTY_BU
, PSB_POSN_NO
, PSB_REJECT_RESV_QTY_BU
, ITEM_MANF_NAME
, PROG_CR_DT
)
SELECT
STC_DIM_ARTICLE.ARTICLE_ID
, STC_DIM_CATEGORY.CATEGORY_ID
, STC_DIM_CAT_MANG.CAT_MANG_ID
, STC_DIM_COMPANIES.COMP_ID
, STC_DIM_DEPARTMENT.DEPARTMENT_ID
, STC_DIM_FOOD_CAT.FOOD_CAT_ID
, STC_DIM_GRADE1.GRADE1_ID
, STC_DIM_GRADE2.GRADE2_ID
, STC_DIM_WMS_WH.WH_ID
, STC_DIM_SIZE.SIZE_ID
, STC_DIM_LOCATION.LOCATION_ID
, STC_DIM_PACKING.PACKING_ID
, STC_DIM_ITEM_UOM.ITEM_UOM_ID
, STC_DIM_ITEM.ITEM_ID
, STC_DIM_WMS_PALLET_POSITION.PALLET_POSITION_ID
, X.PSB_SYS_ID
, X.PSB_PI_SYS_ID
, X.PSB_PALLET_NO
, X.PSB_PALLET_SYS_ID
, X.PSB_RCVD_DT
, X.PSB_BATCH_NO
, X.PSB_MANF_DT
, X.PSB_EXP_DT
, X.PSB_RCVD_QTY_BU
, X.PSB_ISSD_QTY_BU
, X.PSB_STK_QTY_BU
, X.PSB_HOLD_QTY_BU
, X.PSB_RCVD_QTY_BU_1
, X.PSB_RCVD_QTY_BU_2
, X.PSB_RCVD_QTY_BU_3
, X.PSB_RCVD_QTY_BU_4
, X.PSB_RCVD_QTY_BU_5
, X.PSB_ISSD_QTY_BU_1
, X.PSB_ISSD_QTY_BU_2
, X.PSB_ISSD_QTY_BU_3
, X.PSB_ISSD_QTY_BU_4
, X.PSB_ISSD_QTY_BU_5
, X.PSB_RESV_QTY_BU
, X.PSB_REJECT_QTY_BU
, X.PSB_CR_DT
, X.PSB_CR_UID
, X.PSB_UPD_DT
, X.PSB_UPD_UID
, X.PSB_PUW_HOLD_QTY_BU
, X.PSB_POSN_NO
, X.PSB_REJECT_RESV_QTY_BU
, D.IM_MANF_NAME
, sysdate
FROM 
OS_POSITION_BATCH@stcbi X,
OM_ITEM@stcbi E
left outer join   STCBI106.STC_DIM_DEPARTMENT STC_DIM_DEPARTMENT ON 
(E.ITEM_ANLY_CODE_02 = STC_DIM_DEPARTMENT.DEPARTMENT_CODE AND 
E.ITEM_ANLY_CODE_06 = STC_DIM_DEPARTMENT.CLASS_CODE AND
E.ITEM_ANLY_CODE_07 = STC_DIM_DEPARTMENT.SUB_CLASS_CODE)
left outer join   STCBI106.STC_DIM_CATEGORY STC_DIM_CATEGORY ON
(E.ITEM_ANLY_CODE_08 = STC_DIM_CATEGORY.CATEGORY_CODE)
left outer join   STCBI106.STC_DIM_SIZE STC_DIM_SIZE ON
(E.ITEM_ANLY_CODE_12 = STC_DIM_SIZE.SIZE_CODE)
left outer join   STCBI106.STC_DIM_CAT_MANG STC_DIM_CAT_MANG ON
(E.ITEM_ANLY_CODE_13 = STC_DIM_CAT_MANG.CAT_MANG_CODE)
left outer join   STCBI106.STC_DIM_FOOD_CAT STC_DIM_FOOD_CAT ON
(E.ITEM_ANLY_CODE_03 = STC_DIM_FOOD_CAT.FOOD_CAT_CODE AND
E.ITEM_ANLY_CODE_04 = STC_DIM_FOOD_CAT.FOOD_SUB_CAT_CODE)
left outer join   STCBI106.STC_DIM_PACKING STC_DIM_PACKING ON
(E.ITEM_ANLY_CODE_11 = STC_DIM_PACKING.PACKING_CODE)
left outer join   STCBI106.STC_DIM_ARTICLE STC_DIM_ARTICLE ON 
(E.ITEM_ANLY_CODE_10 = STC_DIM_ARTICLE.ARTICLE_CODE) , 
OS_POSITION@stcbi A ,
OS_POSITION_ITEM@stcbi B
left outer join   STCBI106.STC_DIM_GRADE1 STC_DIM_GRADE1 on 
(b.PSI_GRADE_CODE_1 = STC_DIM_GRADE1.GRADE_CODE)
left outer join   STCBI106.STC_DIM_GRADE2 STC_DIM_GRADE2 on 
(b.PSI_GRADE_CODE_2 = STC_DIM_GRADE2.GRADE_CODE)
left outer join STCBI106.STC_DIM_ITEM STC_DIM_ITEM
on (B.PSI_item_CODE = STC_DIM_ITEM.item_CODE)
left outer join STCBI106.STC_DIM_ITEM_UOM STC_DIM_ITEM_UOM
on (B.PSI_item_CODE = STC_DIM_ITEM_UOM.iu_item_CODE AND
B.PSI_PACK_CODE = STC_DIM_ITEM_UOM.IU_UOM_CODE)
left outer join STCBI106.STC_DIM_LOCATION STC_DIM_LOCATION
on (B.PSI_LOCN_CODE = STC_DIM_LOCATION.LOCN_CODE)
left outer join STCBI106.STC_DIM_WMS_PALLET_POSITION STC_DIM_WMS_PALLET_POSITION
on (B.PSI_POSN_NO = STC_DIM_WMS_PALLET_POSITION.PP_PALLET_POSN_NO)
left outer join STCBI106.stc_dim_companies stc_dim_companies
on (stc_diM_companies.company_code=B.PSI_COMP_CODE)
left outer join STCBI106.STC_DIM_WMS_WH STC_DIM_WMS_WH
on (STC_DIM_WMS_WH.WH_CODE=B.PSI_WH_CODE)
left outer join OM_ITEM_PACK@stcbi c
on (B.PSI_ITEM_CODE= c.IP_ITEM_CODE and B.PSI_PACK_CODE = c.IP_PACK_UOM_CODE)
left outer join OM_ITEM_MANF@stcbi D  
on (B.PSI_ITEM_CODE= D.IM_ITEM_CODE AND B.PSI_PACK_CODE = D.IM_MANF_PART_NO)
WHERE A.PS_SYS_ID = B.PSI_PS_SYS_ID AND
X.PSB_PI_SYS_ID = B.PSI_SYS_ID and
B.PSI_ITEM_CODE = E.ITEM_CODE AND
to_date(X.PSB_CR_DT,'DD-MM-YYYY')>=TO_DATE('1-JULY-09','DD-MM-YYYY')
and to_date(X.PSB_CR_DT,'DD-MM-YYYY')<TO_DATE('sysdate','DD-MM-YYYY');
COMMIT;